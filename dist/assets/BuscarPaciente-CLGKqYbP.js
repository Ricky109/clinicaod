import{_ as V,r as m,l as G,m as C,c as i,a as n,b as u,t as I,h as a,F as N,w as v,v as A,n as $,p as w,q as F,j as X,s as j,u as q,k as z,o}from"./index-Bp0xLay2.js";import{u as H}from"./pacienteStore-DaLpOX90.js";import"./pagoService-DPhzBUMq.js";const Z={class:"card"},J={class:"grid grid-2"},K=["value"],Q={style:{"text-align":"center"}},W=["disabled"],Y={key:0,class:"error-message"},h={key:1,class:"mt-2"},ee={class:"grid grid-1"},te=["value"],ae={key:0,class:"campo-obligatorio"},ne={key:1,class:"campo-obligatorio"},le={key:2,class:"campo-obligatorio"},oe=["value"],ie={key:0,class:"campo-obligatorio"},se={class:"input-group"},ue=["readonly"],re={class:"action-slot"},pe={key:4,class:"campo-obligatorio"},ce={class:"mt-2 button-group"},de={key:2,class:"btn btn-primary btn-buscar",disabled:"",title:"Complete el registro del paciente para continuar"},ve={__name:"BuscarPaciente",setup(Ee){const e=H(),c=m(""),E=m(!1),p=m(""),r=m(!1),d=m(!1);function M(){c.value="",E.value=!1,p.value="",r.value=!1,d.value=!1,e.paciente=null,e.nuevo=!1,e.tratamientos=[],e.nroPago=null,e.montoTotal=0,e.estadoPago="PENDIENTE"}G(()=>{M()});function f(s){return s.replace(/\D/g,"").slice(0,8)}function R(s){const t=f(s.target.value);c.value=t,s.target.value=t}function g(s){return s?String(s).toUpperCase().replace(/[^A-ZÁÉÍÓÚÜÑ\s]/g,""):""}async function D(){try{if(p.value="",c.value.length!==8){p.value="El DNI debe tener exactamente 8 dígitos";return}E.value=!0,await e.buscarPaciente(c.value),e.nuevo?(r.value=!1,e.paciente.CAPEPAT="",e.paciente.CAPEMAT="",e.paciente.CNOMBRE=""):r.value=!1}catch(s){p.value=s.message}finally{E.value=!1}}async function O(){var s,t,b;try{p.value="";const l=q();if(e.nuevo&&(e.paciente.CAPEPAT=(s=e.paciente.CAPEPAT)==null?void 0:s.trim(),e.paciente.CAPEMAT=(t=e.paciente.CAPEMAT)==null?void 0:t.trim(),e.paciente.CNOMBRE=(b=e.paciente.CNOMBRE)==null?void 0:b.trim()),e.paciente.DNACIMI){const y=String(e.paciente.DNACIMI);if(y.includes("/")){const[U,_,x]=y.split("/");e.paciente.DNACIMI=`${x}-${_}-${U}`}}e.paciente.CDNIEST=l.dniTratante,await e.registrarPaciente(e.paciente),r.value=!1}catch(l){p.value=l.message}}function T(){r.value=!0}function k(){r.value=!1}const S=C(()=>e.nuevo||r.value),P=C(()=>e.nuevo||r.value),L=C(()=>e.nuevo);C(()=>!e.nuevo&&e.paciente);const B=C(()=>!!e.paciente&&!e.nuevo);return(s,t)=>{const b=z("router-link");return o(),i("div",Z,[t[21]||(t[21]=n("h2",{style:{"text-align":"center"}},"BUSCAR/REGISTRAR PACIENTE",-1)),n("div",J,[n("input",{class:"input",placeholder:"DNI PACIENTE (8 dígitos)",value:c.value,onInput:R,maxlength:"8",inputmode:"numeric",pattern:"[0-9]{8}"},null,40,K),n("div",Q,[n("button",{class:"btn btn-primary btn-buscar",onClick:D,disabled:E.value||c.value.length!==8},I(E.value?"🔍 Buscando...":"🔍 Buscar"),9,W)])]),p.value?(o(),i("p",Y,I(p.value),1)):u("",!0),a(e).paciente?(o(),i("div",h,[t[20]||(t[20]=n("h3",null,"DATOS DEL PACIENTE",-1)),n("div",ee,[t[17]||(t[17]=n("label",null,"DNI:",-1)),n("input",{class:"input input-readonly",value:a(e).paciente.CNRODNI,readonly:""},null,8,te),a(e).nuevo?(o(),i(N,{key:0},[t[10]||(t[10]=n("label",null,"PRIMER APELLIDO:",-1)),v(n("input",{class:"input","onUpdate:modelValue":t[0]||(t[0]=l=>a(e).paciente.CAPEPAT=l),onInput:t[1]||(t[1]=l=>a(e).paciente.CAPEPAT=g(a(e).paciente.CAPEPAT)),placeholder:"INGRESE PRIMER APELLIDO"},null,544),[[A,a(e).paciente.CAPEPAT]]),d.value&&!(a(e).paciente.CAPEPAT||"").trim()?(o(),i("small",ae,"*Campo obligatorio*")):u("",!0),t[11]||(t[11]=n("label",null,"SEGUNDO APELLIDO:",-1)),v(n("input",{class:"input","onUpdate:modelValue":t[2]||(t[2]=l=>a(e).paciente.CAPEMAT=l),onInput:t[3]||(t[3]=l=>a(e).paciente.CAPEMAT=g(a(e).paciente.CAPEMAT)),placeholder:"INGRESE SEGUNDO APELLIDO"},null,544),[[A,a(e).paciente.CAPEMAT]]),d.value&&!(a(e).paciente.CAPEMAT||"").trim()?(o(),i("small",ne,"*Campo obligatorio*")):u("",!0),t[12]||(t[12]=n("label",null,"NOMBRES:",-1)),v(n("input",{class:"input","onUpdate:modelValue":t[4]||(t[4]=l=>a(e).paciente.CNOMBRE=l),onInput:t[5]||(t[5]=l=>a(e).paciente.CNOMBRE=g(a(e).paciente.CNOMBRE)),placeholder:"INGRESE NOMBRES"},null,544),[[A,a(e).paciente.CNOMBRE]]),d.value&&!(a(e).paciente.CNOMBRE||"").trim()?(o(),i("small",le,"*Campo obligatorio*")):u("",!0)],64)):(o(),i(N,{key:1},[t[13]||(t[13]=n("label",null,"NOMBRE:",-1)),n("input",{class:"input input-readonly",value:a(e).paciente.CNOMBRE,readonly:""},null,8,oe)],64)),a(e).nuevo?(o(),i(N,{key:2},[t[15]||(t[15]=n("label",null,"SEXO:",-1)),v(n("select",{class:"input","onUpdate:modelValue":t[6]||(t[6]=l=>a(e).paciente.CSEXO=l)},[...t[14]||(t[14]=[n("option",{value:"M"},"MASCULINO",-1),n("option",{value:"F"},"FEMENINO",-1)])],512),[[$,a(e).paciente.CSEXO]])],64)):u("",!0),L.value?(o(),i(N,{key:3},[t[16]||(t[16]=n("label",null,"FECHA DE NACIMIENTO: (DD/MM/AAAA)",-1)),v(n("input",{class:"input input-fecha",type:"date","onUpdate:modelValue":t[7]||(t[7]=l=>a(e).paciente.DNACIMI=l),placeholder:"DD/MM/AAAA"},null,512),[[A,a(e).paciente.DNACIMI]]),d.value&&!(a(e).paciente.DNACIMI||"").toString().trim()?(o(),i("small",ie,"*Campo obligatorio*")):u("",!0)],64)):u("",!0),t[18]||(t[18]=n("label",null,"CELULAR DEL PACIENTE:",-1)),n("div",se,[v(n("input",{class:w(["input input-group-field",{"input-readonly":!P.value}]),"onUpdate:modelValue":t[8]||(t[8]=l=>a(e).paciente.CNROCEL=l),onInput:t[9]||(t[9]=l=>a(e).paciente.CNROCEL=a(e).paciente.CNROCEL.replace(/\D/g,"").slice(0,9)),maxlength:"9",inputmode:"numeric",pattern:"[0-9]{9}",readonly:!P.value,placeholder:"INGRESE NÚMERO DE CELULAR"},null,42,ue),[[A,a(e).paciente.CNROCEL]]),n("div",re,[!a(e).nuevo&&!r.value?(o(),i("button",{key:0,class:"btn-edit right-addon",onClick:T,title:"Editar celular"}," ✏️ ")):r.value&&!a(e).nuevo?(o(),i("button",{key:1,class:"btn btn-secondary btn-cancel",onClick:k}," Cancelar ")):u("",!0)])]),d.value&&!(a(e).paciente.CNROCEL||"").toString().trim()?(o(),i("small",pe,"*Campo obligatorio*")):u("",!0)]),n("div",ce,[S.value?(o(),i("button",{key:0,class:"btn btn-primary btn-buscar",onClick:O},I(a(e).nuevo?"👤 Registrar Paciente":"💾 Guardar Cambios"),1)):u("",!0),B.value?(o(),F(b,{key:1,class:"btn btn-primary btn-buscar",to:"/atencion"},{default:X(()=>[...t[19]||(t[19]=[j(" 🏥 Tratamiento ",-1)])]),_:1})):(o(),i("button",de," 🏥 Tratamiento "))])])):u("",!0)])}}},be=V(ve,[["__scopeId","data-v-d9500fc3"]]);export{be as default};
