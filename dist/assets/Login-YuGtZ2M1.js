import{_ as V,u as w,r as n,c as d,a as t,b as m,w as O,v as A,d as M,t as p,e as T,f as y,F as k,g as P,o as c}from"./index-Bp0xLay2.js";const x={class:"login-wrap"},G={class:"login-card card"},B={class:"field form-floating"},j={class:"field password-field form-floating"},z=["type"],F=["title"],J={class:"forgot-wrap"},K=["onKeyup"],$={class:"mt-2",style:{"text-align":"center"}},W=["disabled"],X={key:0,class:"error-msg mt-1"},q={key:0,class:"modal-overlay",role:"dialog","aria-modal":"true"},H={class:"modal-card card"},Q={class:"modal-body"},Y={class:"field form-floating"},Z={class:"field form-floating"},ee={class:"mt-2"},te=["disabled"],oe={key:0,class:"error-msg mt-1"},ae={key:1,style:{"text-align":"center"}},se={class:"ok-msg mt-1",style:{margin:"12px auto"}},le={__name:"Login",setup(ne){const R=P(),D=w(),o=n({CNRODNI:"",CCLAVE:""}),f=n(!1),r=n(""),v=n(!1),N=n(!1),l=n({CCODALU:"",CEMAIL:""}),E=n(!1),C=n(""),i=n("");function L(a){return String(a||"").replace(/\D+/g,"").slice(0,10)}function b(){v.value=!v.value}async function S(){r.value="";try{if(f.value=!0,o.value.CNRODNI=L(o.value.CNRODNI),!o.value.CNRODNI||o.value.CNRODNI.length!==10){r.value="CODIGO INVALIDO";return}if(!o.value.CCLAVE||String(o.value.CCLAVE).trim().length===0){r.value="CLAVE INVALIDA";return}const a={CNRODNI:o.value.CNRODNI,CCLAVE:o.value.CCLAVE};await D.login(a),R.push("/home")}catch(a){r.value=a.message||"Error"}finally{f.value=!1}}function g(){l.value={CCODALU:"",CEMAIL:""},C.value="",i.value="",N.value=!0}function h(){N.value=!1}async function _(){C.value="",i.value="";try{const a=String(l.value.CCODALU||"").replace(/[^0-9]/g,"").slice(0,10),e=String(l.value.CEMAIL||"").trim();if(!a||a.length!==10){i.value="INGRESE UN C√ìDIGO DE ALUMNO V√ÅLIDO";return}if(!e||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){i.value="INGRESE UN CORREO INSTITUCIONAL V√ÅLIDO";return}E.value=!0;const s="https://transacciones.ucsm.edu.pe/MSERP/MsAplicativos/",I=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ID:"LOGNEWE",CCODALU:a,CEMAIL:e})});if(!I.ok)throw new Error("NO SE PUDO GENERAR LA NUEVA CONTRASE√ëA");const u=await I.json(),U={ID:"ERP0014",CORIGEN:0,CDEDIC:"<b>Estimado usuario:</b>",COBSERV:"Nueva contrase√±a: "+String((u==null?void 0:u.CPASNEW)??""),CASUNTO:"Actualizaci√≥n de contrase√±a",CMENSAJE:"Su clave fue actualizada con √©xito",CEMAIL:String((u==null?void 0:u.CEMAIL)??e)};if(!(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)})).ok)throw new Error("NO SE PUDO ENVIAR EL CORREO");C.value="CORREO ENVIADO CON √âXITO"}catch(a){i.value=a.message||"ERROR AL ENVIAR CORREO"}finally{E.value=!1}}return(a,e)=>(c(),d("div",x,[t("div",G,[e[8]||(e[8]=t("div",{class:"brand"},[t("div",{class:"logo"},"UCSM"),t("div",{class:"subtitle"},"CL√çNICA ODONTOL√ìGICA")],-1)),t("div",B,[O(t("input",{id:"codigo",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.CNRODNI=s),inputmode:"numeric",pattern:"\\\\d{10}",maxlength:"10",onInput:e[1]||(e[1]=s=>o.value.CNRODNI=o.value.CNRODNI.replace(/[^0-9]/g,"").slice(0,10))},null,544),[[A,o.value.CNRODNI]]),e[6]||(e[6]=t("label",{for:"codigo"},"C√ìDIGO DE ESTUDIANTE",-1))]),t("div",j,[O(t("input",{id:"password",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.CCLAVE=s),type:v.value?"text":"password"},null,8,z),[[M,o.value.CCLAVE]]),e[7]||(e[7]=t("label",{for:"password"},"CONTRASE√ëA",-1)),t("span",{class:"eye",onClick:b,title:v.value?"Ocultar contrase√±a":"Mostrar contrase√±a"},p(v.value?"üôà":"üëÅÔ∏è"),9,F)]),t("div",J,[t("a",{href:"#",role:"button",tabindex:"0",class:"forgot-link",onClick:y(g,["prevent"]),onKeyup:T(y(g,["prevent"]),["enter"])}," ¬øOlvidaste tu contrase√±a? ",40,K)]),t("div",$,[t("button",{class:"btn btn-primary login-btn",onClick:S,disabled:f.value}," ‚éÜ Iniciar Sesi√≥n ",8,W)]),r.value?(c(),d("p",X,p(r.value),1)):m("",!0)]),N.value?(c(),d("div",q,[t("div",H,[t("div",{class:"modal-header"},[e[9]||(e[9]=t("h3",null,"RECUPERAR CONTRASE√ëA",-1)),t("button",{class:"close-btn",onClick:h,"aria-label":"Cerrar"},"√ó")]),t("div",Q,[C.value?(c(),d("div",ae,[t("p",se,p(C.value),1)])):(c(),d(k,{key:0},[t("div",Y,[O(t("input",{id:"ccodalu",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.CCODALU=s),inputmode:"numeric",pattern:"\\\\d{10}",maxlength:"10",onInput:e[4]||(e[4]=s=>l.value.CCODALU=String(l.value.CCODALU).replace(/[^0-9]/g,"").slice(0,10))},null,544),[[A,l.value.CCODALU]]),e[10]||(e[10]=t("label",{for:"ccodalu"},"C√ìDIGO DE ESTUDIANTE",-1))]),t("div",Z,[O(t("input",{id:"cemail",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.CEMAIL=s),type:"email"},null,512),[[A,l.value.CEMAIL]]),e[11]||(e[11]=t("label",{for:"cemail"},"CORREO INSTITUCIONAL",-1))]),t("div",ee,[t("button",{class:"btn btn-primary login-btn",style:{width:"100%"},onClick:_,disabled:E.value},p(E.value?"Enviando‚Ä¶":"Enviar correo"),9,te)]),i.value?(c(),d("p",oe,p(i.value),1)):m("",!0)],64))])])])):m("",!0)]))}},de=V(le,[["__scopeId","data-v-b4313118"]]);export{de as default};
