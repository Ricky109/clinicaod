import{_ as M,u as V,r as n,c as d,a as o,b as N,w as m,v as A,d as k,t as p,e as U,f as O,F as x,g as P,o as c}from"./index-ETxFn6l9.js";const T={class:"login-wrap"},G={class:"login-card card"},B={class:"field form-floating"},j={class:"field password-field form-floating"},z=["type"],F=["title"],J={class:"forgot-wrap"},K=["onKeyup"],$={class:"mt-2",style:{"text-align":"center"}},W=["disabled"],q={key:0,class:"error-msg mt-1"},H={key:0,class:"modal-overlay",role:"dialog","aria-modal":"true"},Q={class:"modal-card card"},X={class:"modal-body"},Y={class:"field form-floating"},Z={class:"field form-floating"},ee={class:"mt-2"},oe=["disabled"],ae={key:0,class:"error-msg mt-1"},te={key:1,style:{"text-align":"center"}},se={class:"ok-msg mt-1",style:{margin:"12px auto"}},le={__name:"Login",setup(ne){const b=P(),h=V(),a=n({CNRODNI:"",CCLAVE:""}),g=n(!1),r=n(""),v=n(!1),y=n(!1),l=n({CCODALU:"",CEMAIL:""}),f=n(!1),C=n(""),i=n("");function L(t){return String(t||"").replace(/\D+/g,"").slice(0,10)}function _(){v.value=!v.value}async function D(){r.value="";try{if(g.value=!0,a.value.CNRODNI=L(a.value.CNRODNI),!a.value.CNRODNI||a.value.CNRODNI.length!==10){r.value="CODIGO INVALIDO";return}if(!a.value.CCLAVE||String(a.value.CCLAVE).trim().length===0){r.value="CLAVE INVALIDA";return}const t={CNRODNI:a.value.CNRODNI,CCLAVE:a.value.CCLAVE};await h.login(t),b.push("/home")}catch(t){r.value=t.message||"Error"}finally{g.value=!1}}function E(){l.value={CCODALU:"",CEMAIL:""},C.value="",i.value="",y.value=!0}function R(){y.value=!1}async function w(){C.value="",i.value="";try{const t=String(l.value.CCODALU||"").replace(/[^0-9]/g,"").slice(0,10),e=String(l.value.CEMAIL||"").trim();if(!t||t.length!==10){i.value="Ingrese un c√≥digo de alumno v√°lido";return}if(!e||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){i.value="Ingrese un correo institucional v√°lido";return}f.value=!0;const s="https://transacciones.ucsm.edu.pe/MSERP/MsAplicativos/",I=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ID:"LOGNEWE",CCODALU:t,CEMAIL:e})});if(!I.ok)throw new Error("No se pudo generar la nueva contrase√±a");const u=await I.json(),S={ID:"ERP0014",CORIGEN:0,CDEDIC:"<b>Estimado usuario:</b>",COBSERV:"Nueva contrase√±a: "+String((u==null?void 0:u.CPASNEW)??""),CASUNTO:"Actualizaci√≥n de contrase√±a",CMENSAJE:"Su clave fue actualizada con √©xito",CEMAIL:String((u==null?void 0:u.CEMAIL)??e)};if(!(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).ok)throw new Error("No se pudo enviar el correo");C.value="Correo enviado con √©xito"}catch(t){i.value=t.message||"Error al enviar correo"}finally{f.value=!1}}return(t,e)=>(c(),d("div",T,[o("div",G,[e[8]||(e[8]=o("div",{class:"brand"},[o("div",{class:"logo"},"UCSM"),o("div",{class:"subtitle"},"CL√çNICA ODONTOL√ìGICA")],-1)),o("div",B,[m(o("input",{id:"codigo",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[0]||(e[0]=s=>a.value.CNRODNI=s),inputmode:"numeric",pattern:"\\\\d{10}",maxlength:"10",onInput:e[1]||(e[1]=s=>a.value.CNRODNI=a.value.CNRODNI.replace(/[^0-9]/g,"").slice(0,10))},null,544),[[A,a.value.CNRODNI]]),e[6]||(e[6]=o("label",{for:"codigo"},"C√ìDIGO",-1))]),o("div",j,[m(o("input",{id:"password",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.CCLAVE=s),type:v.value?"text":"password"},null,8,z),[[k,a.value.CCLAVE]]),e[7]||(e[7]=o("label",{for:"password"},"CONTRASE√ëA",-1)),o("span",{class:"eye",onClick:_,title:v.value?"Ocultar contrase√±a":"Mostrar contrase√±a"},p(v.value?"üôà":"üëÅÔ∏è"),9,F)]),o("div",J,[o("a",{href:"#",role:"button",tabindex:"0",class:"forgot-link",onClick:O(E,["prevent"]),onKeyup:U(O(E,["prevent"]),["enter"])}," ¬øOlvidaste tu contrase√±a? ",40,K)]),o("div",$,[o("button",{class:"btn btn-primary login-btn",onClick:D,disabled:g.value}," ‚éÜ Iniciar Sesi√≥n ",8,W)]),r.value?(c(),d("p",q,p(r.value),1)):N("",!0)]),y.value?(c(),d("div",H,[o("div",Q,[o("div",{class:"modal-header"},[e[9]||(e[9]=o("h3",null,"Recuperar contrase√±a",-1)),o("button",{class:"close-btn",onClick:R,"aria-label":"Cerrar"},"√ó")]),o("div",X,[C.value?(c(),d("div",te,[o("p",se,p(C.value),1)])):(c(),d(x,{key:0},[o("div",Y,[m(o("input",{id:"ccodalu",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.CCODALU=s),inputmode:"numeric",pattern:"\\\\d{10}",maxlength:"10",onInput:e[4]||(e[4]=s=>l.value.CCODALU=String(l.value.CCODALU).replace(/[^0-9]/g,"").slice(0,10))},null,544),[[A,l.value.CCODALU]]),e[10]||(e[10]=o("label",{for:"ccodalu"},"C√≥digo de alumno",-1))]),o("div",Z,[m(o("input",{id:"cemail",class:"input fancy-input",placeholder:" ","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.CEMAIL=s),type:"email"},null,512),[[A,l.value.CEMAIL]]),e[11]||(e[11]=o("label",{for:"cemail"},"Correo institucional",-1))]),o("div",ee,[o("button",{class:"btn btn-primary login-btn",style:{width:"100%"},onClick:w,disabled:f.value},p(f.value?"Enviando‚Ä¶":"Enviar correo"),9,oe)]),i.value?(c(),d("p",ae,p(i.value),1)):N("",!0)],64))])])])):N("",!0)]))}},de=M(le,[["__scopeId","data-v-9d3a355f"]]);export{de as default};
